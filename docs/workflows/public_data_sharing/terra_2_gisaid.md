# Terra_2_GISAID

## Quick Facts

| **Workflow Type** | **Applicable Kingdom** | **Last Known Changes** | **Command-line Compatibility** | **Workflow Level** |
|---|---|---|---|---|
| [Public Data Sharing](../../workflows_overview/workflows_type.md/#public-data-sharing) | [Viral](../../workflows_overview/workflows_kingdom.md/#viral) | PHB v1.2.1 | Yes | Set-level |

## Terra_2_GISAID_PHB

Terra_2_GISAID programmatically submits SARS-CoV-2 assembly files to GISAID.

This workflow expects data that has been prepared for submission using either Mercury_Batch or Mercury_Prep_N_Batch (recommended).

!!! dna "client-ID"
    To obtain a client-ID, contact `clisupport@gisaid.org` and include your username in your request.

### Inputs

The optional variable `frameshift_notification` has three options that correspond to the associated web-browser options:

- "**catch_all**" - "Notify me about ALL DETECTED FRAMESHIFTS in this submission for reconfirmation of affected sequences"
- "**catch_novel**" [DEFAULT] - "Notify me only about NOT PREVIOUSLY REPORTED FRAMESHIFTS in this submission for reconfirmation of affected sequences"
- "**catch_none**" - "I confirm ANY FRAMESHIFTS in this submission and request their release without confirmation by a curator"

!!! warning "GISAID Credentials"
    Please note that the user must provide either an authentication_file or a gisaid_credentials file to run this workflow; explanations for both can be found in the table below.

This workflow runs on the sample level.

<div class="searchable-table" markdown="1">

| **Terra Task Name** | **Variable** | **Type** | **Description** | **Default Value** | **Terra Status** |
|---|---|---|---|---|---|
| Terra_2_GISAID | **client_id** | String | This value should be filled with the client-ID provided by GISAID | | Required |
| Terra_2_GISAID | **concatenated_fastas** | File | The GISAID FASTA file generated by Mercury_Prep_N_Batch (or Mercury_Prep)  | | Required |
| Terra_2_GISAID | **concatenated_metadata** | File | The GISAID metadata file generated by Mercury_Prep_N_Batch (or Mercury_Prep) | | Required |
| gisaid_upload | **authentication_file** | File | [EITHER] The GISAID authentication file generated by running cli3 authenticate for the submitter. | | Optional, Required |
| gisaid_upload | **cpu** | Int | Number of CPUs to allocate to the task | 1 | Optional |
| gisaid_upload | **disk_size** | Int | Amount of storage (in GB) to allocate to the task | 100 | Optional |
| gisaid_upload | **docker** | String | The Docker container to use for the task | us-docker.pkg.dev/general-theiagen/broadinstitute/gisaid-cli:3.0 | Optional |
| gisaid_upload | **frameshift_notification** | String | See top of inputs section for explanation; the notification preference regarding frameshifts in your submission | catch_novel | Optional |
| gisaid_upload | **gisaid_credentials** | File | [EITHER] A tab-delimited file containing the submitter's GISAID username followed by their password, used to generate the GISAID authentication file. | | Optional, Required |
| gisaid_upload | **memory** | Int | Amount of memory/RAM (in GB) to allocate to the task | 2 | Optional |
| version_capture | **docker** | String | The Docker container to use for the task | "us-docker.pkg.dev/general-theiagen/theiagen/alpine-plus-bash:3.20.0" | Optional |
| version_capture | **timezone** | String | Set the time zone to get an accurate date of analysis (uses UTC by default) |  | Optional |

</div>

### Outputs

<div class="searchable-table" markdown="1">

| **Variable** | **Type** | **Description** |
|---|---|---|
| failed_uploads | Boolean | The metadata for any failed uploads |
| gisaid_cli_version | String | The verison of the GISAID CLI tool |
| gisaid_logs | File | The log files regarding the submission |
| terra_2_gisaid_analysis_date | String | The date of the analysis |
| terra_2_gisaid_version | String | The version of the PHB repository that this workflow is hosted in |

</div>
